<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2016 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Adding Form Validation Rules -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Collecting_User_Input_with_Forms/Example__Creating_the_Contact_Form_Model.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Collecting_User_Input_with_Forms/Using_the_Form_in_a_Controller_s_Action.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Collecting_User_Input_with_Forms.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Collecting User Input with Forms</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">

<h2 id="header-163">7.9. Adding Form Validation Rules</h2>
<p>Form validation is the procedure of filtering and checking the data passed to the server 
during the form submission. For example, for our feedback form, we want to perform 
the following checks:</p>
<ul>
<li>We want to test that the E-mail address, message subject, and body fields are always
present (because these fields are <em>required</em>).</li>
<li>We want to ensure that the user entered a valid E-mail address like <em>name@example.com</em>.</li>
<li>Users may add white space characters to the beginning and/or the end of the E-mail
address, so we would like to filter such characters out (perform the string trimming
operation). </li>
<li>It would be useful to check for minimum and maximum allowed length of the message subject and
body text. </li>
<li>For the message subject, we would like to filter out (strip) the new line characters and HTML tags <sup id="fnref:html"><a href="#fn:html" class="footnote-ref" rel="footnote">22</a></sup>. </li>
<li>We also want to strip HTML tags from the message body.</li>
</ul>
<footnotes id="fn:html"><p><sup>22)</sup> There may be malicious users inserting HTML code in the message. If you open
such code in your browser, you may see some undesired content. To avoid
this, we need to replace HTML tags in message subject and text.</p>
</footnotes>
<p>The requirements above are called <em>validation rules</em>. Validation rules can be
divided into two categories: filters and validators. </p>
<p>The <em>filters</em> transform the user-entered data to fix possible errors 
or to ensure the data conforms to a certain format. Filters are typically applied first, 
validators are applied in the last turn. </p>
<p><em>Validators</em> check whether the data is acceptable or not. If all data is correct,
the form is considered valid and the data can be safely used by the business logic layer. 
If a certain field is invalid, a validator raises an error flag. In that case, the form is 
typically shown to the user again, and the user is asked to correct any input errors and resend 
the form to server. </p>
<blockquote class="notquote question" data-type="question"><p> <strong>What happens if I don't add a validation rule for a certain form field?</strong></p>
<p> If you do not add a validation rule then the user-submitted field value
 will not be checked, leaving a hole in your site's security. It is recommended
 to always add a validation rule per each form field entered by user and add as many 
 checks per each field as needed to keep your form secure.</p>
</blockquote><h3 id="header-164">7.9.1. Input Filter</h3>
<p>In ZF3, you store the validation rules with the help of the <code>InputFilter</code> class.
The <code>InputFilter</code> class is defined in the <code>Zend\InputFilter</code> component. 
The input filter is a container for so called <em>inputs</em>. Typically, you add an input
per each form model's field you have.</p>
<blockquote class="notquote information" data-type="information"><p> An input may consist of filters and/or validators and some additional information.
 For example, an input may contain the flag telling if the field is required or if its value may
 be missing from HTTP request. </p>
</blockquote><p>Analogous to adding a form model's fields, there are two possible ways of adding
inputs to the input filter container: either via passing an instance of an input
class as the argument of its <code>add()</code> method, or via passing the array specification <sup id="fnref:inputfactory"><a href="#fn:inputfactory" class="footnote-ref" rel="footnote">23</a></sup>.
In the next section, we will describe the latter method (it is preferable, 
because it requires less code to write).</p>
<footnotes id="fn:inputfactory"><p><sup>23)</sup> In the latter (array specification) case, the input will be 
automatically created with the help of the <code>Zend\InputFilter\Factory</code> class.</p>
</footnotes>
<h3 id="header-165">7.9.2. Adding Inputs to Input Filter</h3>
<p>To add an input to the input filter, you use its <code>add()</code> method, which takes the single
argument - an array specification of the input in the following form:</p>
<pre class="line-numbers"><code class="language-php">[
  'name'     =&gt; '&lt;name&gt;',
  'type'     =&gt; '&lt;type&gt;',
  'required' =&gt; &lt;required&gt;,
  'filters'  =&gt; [
     // Add filters configuration here ...
  ],                
  'validators' =&gt; [
     // Add validators configuration here ...
  ]
]
</code></pre>
<p>In the above array, we have the following keys:</p>
<ul>
<li><p>The <code>name</code> key (line 2) defines the name of the input. The name should be
the same as the name of the form model's field. If the name of the input doesn't 
match the name of the corresponding form model's field, the validation rule
won't be applied to the field.</p>
</li>
<li><p>The <code>type</code> key (line 3) defines the class name of the input. This key is optional.
By default (when this key is omitted), the <code>Zend\InputFilter\Input</code> class is used. 
Available input classes are shown in figure 7.16. In figure 7.16, the <code>Input</code> class 
is designed to be used with regular scalar values, <code>ArrayInput</code> is used
for filtering/validating array values, and <code>FileInput</code> is used for checking uploaded files.  </p>
</li>
<li><p>The <code>required</code> key (line 4) tells whether the form field is required or optional. If the
field is required, the site user will have to fill it in; otherwise he will
receive a validation error.</p>
</li>
<li><p>the <code>filters</code> (line 5) and <code>validators</code> (line 8) keys may contain the configuration for zero,
one, or several filters and/or validators applied to the form model's field. </p>
</li>
</ul>
<p><span class="image-wrapper">
<a target="_blank" href="../images/forms/input_inheritance.png">
<img src="../images/forms/input_inheritance.png" alt="Figure 7.16. Input class inheritance" /></a>
<span class="image-caption">Figure 7.16. Input class inheritance</span>
</span>
</p>
<h4 id="header-166">7.9.2.1. Filter Configuration</h4>
<p>A typical filter configuration is presented below:  </p>
<pre class="line-numbers"><code class="language-php">[
  'name' =&gt; '&lt;filter_name&gt;',  
  'priority' =&gt; &lt;priority&gt;,
  'options' =&gt; [
    // Filter options go here ...
  ]
],                    
</code></pre>
<p>The <code>name</code> key (line 2) is the name for the filter. This may be either
a fully qualified filter class name (e.g. <code>StringTrim::class</code> or an alias (e.g. <code>StringTrim</code>).</p>
<p>The optional <code>priority</code> key (line 3) defines filter priority in the list of filters. The priority
must be an integer number. The filters with the highest priority will be applied first. By default, 
the <code>FilterChain::DEFAULT_PRIORITY</code> constant (value 1000) is assigned.</p>
<p>The <code>options</code> array (line 4) is specific to a certain filter and may contain
parameters for configuring the filter.</p>
<h4 id="header-167">7.9.2.2. Validator Configuration</h4>
<p>A typical validator configuration is presented below:</p>
<pre class="line-numbers"><code class="language-php">[
  'name' =&gt; '&lt;validator_name&gt;',
  'break_chain_on_failure' =&gt; &lt;flag&gt;,
  'options' =&gt; [
    // Validator options go here ...
  ]
],                    
</code></pre>
<p>The <code>name</code> key (line 2) is the name for the validator. This may be either
a fully qualified validator class name (e.g. <code>EmailAddress::class</code> or an alias 
(e.g. <code>EmailAddress</code>).  </p>
<p>The <code>break_chain_on_failure</code> optional key (line 3) defines the behavior in 
case the validator check fails. If this equals to <code>true</code>, subsequent validators
in the list will not be executed; otherwise every validator in the list will be executed
without depending on the result of other validators.</p>
<p>The <code>options</code> array (line 4) is specific to certain validator class and may contain
parameters for configuring the validator.</p>
<h4 id="header-168">7.9.2.3. Attaching Input Filter to Form Model</h4>
<p>Once you have created and populated the input filter container, you
have to attach it to the form model. The <code>Form</code> base class provides
the <code>setInputFilter()</code> method intended for this purpose (see table 7.10).</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.10. Methods provided by the Form base class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>setInputFilter($inputFilter)</code> </td>
<td>  Attaches the input filter container to the form.              </td>
</tr>
<tr>
<td> <code>getInputFilter()</code>             </td>
<td> Retrieves the input filter attached to the form.              </td>
</tr>
</tbody>
</table>
</div>
<h3 id="header-169">7.9.3. Creating Input Filter for the Contact Form</h3>
<p>Now that you have a general idea on know how to define the input filter container 
and populate it with filters and validators for each form field, let's complete
our <code>ContactForm</code> form model class. Below, we add the <code>addInputFilter()</code> 
private method, which defines the filtering/validation rules, stores them in input filter container,
and attaches the input filter to the form model:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// ...
use Zend\InputFilter\InputFilter;

class ContactForm extends Form
{
  public function __construct()
  {
    // ... call this method to add validation rules
    $this-&gt;addInputFilter();
  }
    
  // ...
    
  // This method creates input filter (used for form filtering/validation).
  private function addInputFilter() 
  {
    $inputFilter = new InputFilter();        
    $this-&gt;setInputFilter($inputFilter);
        
    $inputFilter-&gt;add([
        'name'     =&gt; 'email',
        'required' =&gt; true,
        'filters'  =&gt; [
           ['name' =&gt; 'StringTrim'],                    
        ],                
        'validators' =&gt; [
           [
            'name' =&gt; 'EmailAddress',
            'options' =&gt; [
              'allow' =&gt; \Zend\Validator\Hostname::ALLOW_DNS,
              'useMxCheck' =&gt; false,                            
            ],
          ],
        ],
      ]
    );
        
    $inputFilter-&gt;add([
        'name'     =&gt; 'subject',
        'required' =&gt; true,
        'filters'  =&gt; [
           ['name' =&gt; 'StringTrim'],
           ['name' =&gt; 'StripTags'],
           ['name' =&gt; 'StripNewLines'],
        ],                
        'validators' =&gt; [
           [
            'name' =&gt; 'StringLength',
              'options' =&gt; [
                'min' =&gt; 1,
                'max' =&gt; 128
              ],
           ],
        ],
      ]
    );
    
    $inputFilter-&gt;add([
        'name'     =&gt; 'body',
        'required' =&gt; true,
        'filters'  =&gt; [                    
          ['name' =&gt; 'StripTags'],
        ],                
        'validators' =&gt; [
          [
            'name' =&gt; 'StringLength',
            'options' =&gt; [
              'min' =&gt; 1,
              'max' =&gt; 4096
            ],
          ],
        ],
      ]
    );                
  }  
}
</code></pre>
<p>As you can see from the code above, first we declare the alias for the
<code>Zend\InputFilter\InputFilter</code> class (line 3).</p>
<p>In the form model's constructor (line 10), we call the <code>addInputFilter()</code> method
which we define in lines 16-76. </p>
<p>The <code>addInputFilter()</code> method's goal is to create the <code>InputFilter</code> container 
(line 18), attach it to form model (line 19) and add filtering/
validation rules (lines 21-75). For attaching the input filter to the form model, we
use the <code>setInputFilter()</code> method provided by the <code>Form</code> base class. For inserting filtering/validation rules into the
input filter container, we use the <code>add()</code> method provided by the <code>InputFilter</code> class, which takes the array specification
of an input to create.</p>
<p>We add three inputs (per each field of our form model, except its submit button):</p>
<ul>
<li><p>For the <code>email</code> field, we set the <code>required</code> flag to <code>true</code> to make filling this
field mandatory. We use <code>StringTrim</code> filter to remove white spaces from the beginning
and the end of the E-mail address; and the <code>EmailAddress</code> validator for checking the
user-entered E-mail address for correctness. We configure the <code>EmailAddress</code> validator
to allow domain names as E-mail addresses (the <code>\Zend\Validator\Hostname::ALLOW_DNS</code> flag)
and disable MX record checking (set <code>useMxCheck</code> option to <code>false</code>).   </p>
</li>
<li><p>For the <code>subject</code> field, by analogy, we make it required, and use the <code>StringTrim</code> filter
to remove white spaces from the beginning and the end. Additionally, we use the <code>StripNewLines</code>
and <code>StripTags</code> filters to filter out the new line characters and HTML tags, respectively.
We constrain subject string length to be between 1 and 128 characters in length by using the
<code>StringLength</code> validator.</p>
</li>
<li><p>For the <code>body</code> field, we require it to be mandatory, and we use the <code>StripTags</code> filter
to strip HTML tags from E-mail text. We also use the <code>StringLength</code> validator to
constrain E-mail text to be between 1 and 4096 characters in length.</p>
</li>
</ul>
<p>In figure 7.17, you can find the schematic graphical representation of the input
filter we've created.</p>
<p><span class="image-wrapper">
<a target="_blank" href="../images/forms/input_filter.png">
<img src="../images/forms/input_filter.png" alt="Figure 7.17. The input filter for ContactForm" /></a>
<span class="image-caption">Figure 7.17. The input filter for ContactForm</span>
</span>
</p>
<blockquote class="notquote tip" data-type="tip"><p> Above, we briefly described how to create an input filter for the form model. 
 For detailed information about the above mentioned (and other) filters and validators and their
 usage examples, please refer to <a href="../Transforming_Input_Data_with_Filters.html">Transforming Input Data with Filters</a> and 
<a href="../Checking_Input_Data_with_Validators.html">Checking Input Data with Validators</a>.</p>
</blockquote>        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Collecting_User_Input_with_Forms.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Collecting User Input with Forms</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Collecting_User_Input_with_Forms/Example__Creating_the_Contact_Form_Model.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Collecting_User_Input_with_Forms/Using_the_Form_in_a_Controller_s_Action.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2016 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a> on 2016-09-11 at 23:08            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

