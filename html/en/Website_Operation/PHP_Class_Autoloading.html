<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2016 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>PHP Class Autoloading -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Website_Operation/PHP_Interfaces.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Website_Operation/HTTP_Request_and_Response.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Website_Operation.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Website Operation</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">

<h2 id="header-46">3.3. PHP Class Autoloading</h2>
<p>A web application consists of many PHP classes, and
each class typically resides in a separate file. This introduces
the need of <em>including</em> the files. </p>
<p>For example, let's assume we have the file named <em>Application.php</em> 
which contains the definition for the <code>\Zend\Mvc\Application</code> class 
from the previous section. Before you can 
create an instance of the <code>Application</code> class somewhere in your code, 
you have to include the contents of <em>Application.php</em> file (you can do this with the
help of <code>require_once</code> statement, passing it the full path to the file):</p>
<pre class=""><code class="language-php">&lt;?php
require_once "/path/to/zend/lib/Application.php";

use Zend\Mvc\Application;

$application = new Application;
</code></pre>
<p>As your application grows in size, it may be difficult to include
each needed file. Zend Framework 3 itself consists of hundreds of files,
and it can be very difficult to load the entire library and all its 
dependencies this way. Moreover, when executing the resulting code, PHP interpreter will 
take CPU time to process each included file, even if you don't create an 
instance of its class.</p>
<p>To fix this problem, in PHP, the class autoloading feature has been introduced.
The PHP function <code>spl_autoload_register()</code> allows you to register 
an <em>autoloader</em> function. For complex websites, you even can create
several autoloader functions, which are chained in a stack. </p>
<p>During script execution, if PHP interpreter encounters a class name 
which has not been defined yet, it calls all the registered autoloader functions
in turn, until either the autoloader function includes the class or "not found" error is
raised. This allows for "lazy" loading, when PHP interpreter processes the class
definition only at the moment of class invocation, when it is really needed.</p>
<p>To give you an idea of how an autoloader function looks like, below we provide a
simplified implementation of an autoloader function:</p>
<pre class=""><code class="language-php">&lt;?php
// Autoloader function.
function autoloadFunc($className) 
{
  // Class map static array.
  static $classMap = [
    '\\Zend\\Mvc\\Application' =&gt; '/path/to/zend/dir/Zend/Mvc/Application.php',
    '\\Application\\Module' =&gt; '/path/to/app/dir/Application/Module.php',
    //...
  ];

  // Check if such a class name presents in the class map.
  if(isset(static::$classMap[$className])) {
    $fileName = static::$classMap[$className];
  
    // Check if file exists and is readable.
    if (is_readable($filename)) {
      // Include the file.
      require $filename;
    }
  }
}

// Register our autoloader function.
spl_autoload_register("autoloadFunc");
</code></pre>
<p>In the above example, we define the <code>autoloadFunc()</code> autoloader function, 
which we will further refer to as the <em>class map</em> autoloader.</p>
<p>The class map autoloader uses the class map for mapping between class name and 
absolute path to PHP file containing that class. The class map is just a usual PHP
array containing keys and values. To determine the file path by class name, the 
class map autoloader just needs to fetch the value from the class map array.
It is obvious, that the class map autoloader works very fast. However, the disadvantage 
of it is that you have to maintain the class map and update it each time you add a new 
class to your program.</p>
<h3 id="header-47">3.3.1. PSR-0 Standard</h3>
<p>Because each library's vendor uses its own code naming and file organization conventions,
you will have to register a different custom autoloader function per each dependent library,
which is rather annoying (and actually this is an unneeded work). To resolve this problem, 
the PSR-0 and PSR-4 standards were introduced.</p>
<blockquote class="notquote information" data-type="information"><p> PSR stands for PHP Standards Recommendation.</p>
</blockquote><p>The <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md">PSR-0 standard</a>
defines the recommended code structure that an application or library must follow
to guarantee autoloader interoperability. In two words, the standard says that:</p>
<ul>
<li><p>The class namespaces should be organized in the following way: </p>
<p><code>\&lt;Vendor Name&gt;\(&lt;Namespace&gt;)*\&lt;Class Name&gt;</code></p>
</li>
<li><p>Namespaces can have as many nesting levels as desired, 
but the <em>Vendor Name</em> should be the top-level namespace. </p>
</li>
<li><p>Namespaces should map to directory structure. Each namespace separator ('\')
is converted to a OS-specific <code>DIRECTORY_SEPARATOR</code> constant when loading from the file system.</p>
</li>
<li><p>The class name is suffixed with <em>.php</em> extension when loading the file from the file system.</p>
</li>
</ul>
<p>For example, for the <code>Zend\Mvc\Application</code> class, 
you will have the following directory structure:</p>
<pre class=""><code class="language-text">/path/to/zend/lib
  /Zend
    /Mvc
       Application.php
</code></pre>
<p>For the code conforming to the PSR-0 standard, we can write and register 
an autoloader, which we will refer to as the "standard" autoloader:</p>
<pre class=""><code class="language-php">&lt;?php

// "Standard" autoloader function.
function standardAutoloadFunc($className) 
{
  // Replace special characters in class name.
  $className = str_replace('\\', '/', $className);
  // Format the file path.
  $fileName = "/path/to/zend/lib/" . $className . ".php";
  // Check if file exists and is readable.
  if (is_readable($fileName)) {
    // Include the file.
    require $fileName;
  } 
}

// Register the autoloader function.
spl_autoload_register("standardAutoloadFunc");
</code></pre>
<p>The standard autoloader works as follows. Assuming that the class namespace 
can be mapped to the directory structure one-by-one, the function calculates 
the path to PHP file by transforming back-slashes (namespace separators) to 
forward slashes (path separators) and concatenating the resulting path with 
the absolute path to the directory where the library is located. Then the 
function checks if such a PHP file really exists, and if so, includes it 
with the <code>require</code> statement.</p>
<p>It is obvious, that the standard autoloader works slower than the class map autoloader.
However, its advantage is that you don't need to maintain any class map,
which is very convenient when you develop new code and add new classes to
your application.</p>
<blockquote class="notquote information" data-type="information"><p> Zend Framework 3 conforms to PSR-0 standard, making it possible to use standard 
 autoloading mechanism across all its components. It is also compatible with other
 PSR-0 conforming libraries like Doctrine or Symfony.</p>
</blockquote><h3 id="header-48">3.3.2. PSR-4 Standard</h3>
<p>The <a href="http://www.php-fig.org/psr/psr-4/">PSR-4 standard</a> is an extension to PSR-0. Its main addition is that you can define that a contiguous 
series of one or more leading namespace and sub-namespace names corresponds to a "base directory".
For example, if you have the <code>\Zend\Mvc\Application</code> fully qualified class name, and if you define that
the series <code>\Zend\Mvc\</code> corresponds to the "/path/to/zend/lib/" directory, you can organise
your files as follows:</p>
<pre class=""><code class="language-text">/path/to/zend/lib/
    Application.php
</code></pre>
<blockquote class="notquote information" data-type="information"><p> The advantage of PSR-4 is that you don't need to put your code in multiple nested directories,
as you would do with PSR-0. </p>
</blockquote><h3 id="header-49">3.3.3. Composer-provided Autoloader</h3>
<p>Zend Framework 3 uses the autoloader implementation provided by Composer. When you install a package with
Composer, it automatically creates the file <em>APP_DIR/vendor/autoload.php</em>,
which uses the <code>spl_autoload_register()</code> PHP function to register an autoloader. This way all PHP classes
located in <code>APP_DIR/vendor</code> directory are correctly autoloaded.</p>
<p>To autoload PHP classes located in your own modules (like <code>Application</code> module), you'll have to specify
the <code>autoload</code> key in your <code>composer.json</code> file:</p>
<pre class=""><code class="language-json",title="Autoload key of composer.json file">"autoload": {
    "psr-4": {
        "Application\\": "module/Application/src/"
    }
},
</code></pre>
<p>Then the only thing need to be done is to include that file in your website entry script <code>index.php</code>:</p>
<pre class=""><code class="language-php">// Composer autoloading
include __DIR__ . '/../vendor/autoload.php';
</code></pre>
<h3 id="header-50">3.3.4. PSR-4 and Module's Source Directory Structure</h3>
<p>In Zend Skeleton Application, you can see how the PSR-4 standard is applied
in practice. For the default module of your website, the <code>Application</code> module, PHP classes which 
are registered with the standard autoloader are stored under the <code>APP_DIR/module/Application/src</code> 
directory ("src" abbreviation means "source"). </p>
<blockquote class="notquote information" data-type="information"><p> We will refer to the <code>src</code> directory as module's source directory.</p>
</blockquote><p>For example, lets look at the <code>IndexController.php</code> file of <code>Application</code> module (figure 3.2). </p>
<p><span class="image-wrapper">
<a target="_blank" href="../images/operation/psr0_and_dir_structure.png">
<img src="../images/operation/psr0_and_dir_structure.png" alt="Figure 3.2. Skeleton application's directory structure conforms to PSR-4 standard" /></a>
<span class="image-caption">Figure 3.2. Skeleton application's directory structure conforms to PSR-4 standard</span>
</span>
</p>
<p>As you can see, it contains the <code>IndexController</code> class <sup id="fnref:controller"><a href="#fn:controller" class="footnote-ref" rel="footnote">1</a></sup> belonging to <code>Application\Controller</code> namespace. 
To be able to follow the PSR-4 standard and use the standard autoloader with this PHP class, 
we have to put it under the <code>Controller</code> directory under the module's source 
directory. </p>
<footnotes id="fn:controller"><p><sup>1)</sup> <code>IndexController</code> class is the default controller for the skeleton website. 
We will talk about controllers later in chapter <a href="../Model_View_Controller.html">Model-View-Controller</a>.</p>
</footnotes>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Website_Operation.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Website Operation</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Website_Operation/PHP_Interfaces.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Website_Operation/HTTP_Request_and_Response.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2016 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

