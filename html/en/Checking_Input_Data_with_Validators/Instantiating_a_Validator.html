<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Instantiating a Validator -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Checking_Input_Data_with_Validators/Validator_Behaviour_in_Case_of_Invalid_or_Unacceptable_Data.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Checking_Input_Data_with_Validators/About_Validator_Plugin_Manager.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Checking_Input_Data_with_Validators.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Checking Input Data with Validators</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">

<h2 id="Instantiating_a_Validator">9.4. Instantiating a Validator</h2>
<p>In Zend Framework 3, there are several methods of creating a validator: </p>
<ul>
<li>instantiating it manually (with the <code>new</code> operator);</li>
<li>creating it with a factory class (by passing an array configuration); 
this way is used the most frequently when adding validation rules in a form;</li>
<li>instantiating it implicitly with the <code>StaticValidator</code> wrapper class.</li>
</ul>
<p>Next, we will cover these three methods in more details. </p>
<h3 id="Method_1__Manual_Instantiation_of_a_Validator">9.4.1. Method 1. Manual Instantiation of a Validator</h3>
<p>A validator in general can be used not only with forms, but also for validation
of an arbitrary data. In order to do that, you simply create an instance of the 
validator class, configure the validator by using the methods it provides, and 
call the <code>isValid()</code> method on the validator. </p>
<p>For example, let's consider the usage of the <code>EmailAddress</code> validator which checks
an E-mail address for conformance to <a href="https://tools.ietf.org/html/rfc2822">RFC-2822</a> standard. 
An E-mail address typically consists of the local part (user name)
followed by the "at" character (@), which is in turn followed by the host name. For example,
in the "name@example.com" E-mail address, "name" is the local part, and "example.com" is the host name.</p>
<blockquote class="notquote information" data-type="information"><p> The <code>EmailAddress</code> validator is useful for checking an user-entered E-mail addresses on 
 your forms for correctness.
 The validator will check for the correctness of the local part and the host name, 
 for presence of the "at" character (@) and, optionally, will connect to the recipient's 
 host and query the DNS service for existence of the MX (Mail Exchanger) record <sup id="fnref:mx_record"><a href="#fn:mx_record" class="footnote-ref" rel="footnote">30</a></sup>. </p>
</blockquote><footnotes id="fn:mx_record"><p><sup>30)</sup> An MX record is a type of record used in the Domain Name System (DNS).
MX records define one or several mail server addresses assigned to recipient's domain. 			  </p>
</footnotes>
<p>The methods provided by the <code>EmailAddress</code> validator are listed in table 9.2:</p>
<div class="table-wrapper">
<div class="table-caption">Table 9.2. Public methods of the EmailAddress validator</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>__construct($options)</code>        </td>
<td>  Constructs the validator. Accepts the list of options allowing to configure it. </td>
</tr>
<tr>
<td> <code>isValid($value)</code>              </td>
<td> Returns <code>true</code> if the value is a valid E-mail address according to RFC-2822; otherwise returns <code>false</code>. </td>
</tr>
<tr>
<td> <code>getMessages()</code>                </td>
<td> If validation failed, this method will return an array of error messages. </td>
</tr>
<tr>
<td> <code>useDomainCheck($domain)</code>      </td>
<td> Tells the validator to check the host name part for correctness. </td>
</tr>
<tr>
<td> <code>getDomainCheck()</code>             </td>
<td> Returns <code>true</code> if host name part check is enabled.            </td>
</tr>
<tr>
<td> <code>setHostnameValidator($hostnameValidator)</code> </td>
<td> Attaches the validator to use for checking host name part of the E-mail address.  </td>
</tr>
<tr>
<td> <code>getHostnameValidator()</code>       </td>
<td> Returns the validator used for checking host name part of the E-mail address.  </td>
</tr>
<tr>
<td> <code>setAllow($allow)</code>             </td>
<td> Sets the allowed types of host names to be used in an E-mail address. </td>
</tr>
<tr>
<td> <code>getAllow()</code>                   </td>
<td> Returns the allowed types of host names.                      </td>
</tr>
<tr>
<td> <code>useMxCheck($mx)</code>              </td>
<td> Sets whether to perform the check for a valid MX record via DNS service.   </td>
</tr>
<tr>
<td> <code>getMxCheck($mx)</code>              </td>
<td> Returns <code>true</code> if MX check mode is enabled.                   </td>
</tr>
<tr>
<td> <code>useDeepMxCheck($deep)</code>        </td>
<td> Sets whether to use deep validation for MX records.           </td>
</tr>
<tr>
<td> <code>getDeepMxCheck()</code>             </td>
<td> Returns <code>true</code> if the deep MX check mode is enabled; otherwise returns <code>false</code>. </td>
</tr>
<tr>
<td> <code>isMxSupported()</code>              </td>
<td> Returns <code>true</code> if MX checking via <code>getmxrr()</code> PHP function is supported in the system; otherwise returns <code>false</code>. </td>
</tr>
<tr>
<td> <code>getMXRecord()</code>                </td>
<td> After validation, returns the found MX record information.    </td>
</tr>
</tbody>
</table>
</div>
<p>As you can see from the table, the <code>EmailAddress</code> validator, additionally to the 
<code>isValid()</code> and <code>getMessages()</code> methods, provides the constructor method to which 
you can (optionally) pass the complete list of options for initializing the validator.</p>
<blockquote class="notquote information" data-type="information"><p> All standard validators have the constructor method (optionally) accepting an array of options
 for configuring the validator when instantiating it manually. </p>
</blockquote><p>The <code>EmailAddress</code> class also provides a number of methods that can be used for 
setting specific validator options.</p>
<p>The <code>useDomainCheck()</code> method tells whether to check the host name for correctness, or not. 
By default, this check is enabled. The <code>setAllow()</code> method provides an ability to specify 
which types of host names are allowed. You can pass an OR combination
of the <code>ALLOW_</code>-prefixed constants <sup id="fnref:allow_constants"><a href="#fn:allow_constants" class="footnote-ref" rel="footnote">31</a></sup> to the <code>setAllow()</code> method:</p>
<ul>
<li><code>ALLOW_DNS</code>  Allow a domain name (this is the default), </li>
<li><code>IP_ADDRESS</code> Allow an IP address,</li>
<li><code>ALLOW_LOCAL</code> Allow local network name,</li>
<li><code>ALLOW_ALL</code>  Allow all of the above.</li>
</ul>
<footnotes id="fn:allow_constants"><p><sup>31)</sup> The <code>ALLOW_</code>-prefixed constants are provided by the <code>Hostname</code> validator.</p>
</footnotes>
<blockquote class="notquote information" data-type="information"><p> Internally, the <code>EmailAddress</code> validator uses the <code>Hostname</code> validator for checking the host name part
 of an E-mail address. Optionally, you can attach a custom host name validator by using the <code>setHostnameValidator()</code> 
 method, however it is unlikely you will need to do such. </p>
</blockquote><p>The <code>useMxCheck()</code> method tells whether the validator should connect to the recipient's
host and query the DNS server for the MX record(s). If the server has no MX records, than the validation fails. 
You can additionally use the <code>useDeepMxCheck()</code> method to tell the validator to compare the mail 
server addresses extracted from the MX records against the black list of reserved domain names, and perform
additional checks per each detected address.</p>
<blockquote class="notquote tip" data-type="tip"><p> It is not recommended to perform MX check (and deep MX check), because that may take a lot of time and
 increase the web page load time. By default, these checks are disabled.</p>
</blockquote><p>Below, we provide code examples showing two equivalent methods of manual creating of an instance of 
the <code>EmailAddress</code> validator, setting its options and checking an input value:</p>
<p><strong>Example 1. Passing options to the constructor method.</strong></p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// Optionally, define a short alias for the validator class name.
use Zend\Validator\EmailAddress;
use Zend\Validator\Hostname;

// Create an instance of the validator, passing options to the constructor.
$validator = new EmailAddress([
		'allow' =&gt; Hostname::ALLOW_DNS|Hostname::ALLOW_IP|Hostname::ALLOW_LOCAL,
		'mxCheck' =&gt; true,
		'deepMxCheck' =&gt; true
	]);

// Validate an E-mail address.
$isValid = $validator-&gt;isValid('name@example.com'); // Returns true.
$isValid2 = $validator-&gt;isValid('abc'); // Returns false.

if(!$isValid2) {
  // Get error messages in case of validation failure.
  $errors = $validator-&gt;getMessages();
}
</code></pre>
<p>In the code above, we create the <code>EmailAddress</code> validator object with the help of the <code>new</code> operator (line 7).
We pass the array of options to the constructor. We use the <code>allow</code> key to allow an
E-mail address to be a domain name, an IP address or local network address. Also, we use
the <code>mxCheck</code> and <code>deepMxCheck</code> to enable MX record check and deep MX record 
check, respectively.</p>
<p>In line 14, we call the <code>isValid()</code> method and pass it the string value "name@example.com" 
to be checked. The expected output of this call is the boolean <code>true</code>.</p>
<p>In line 15, we pass the "abc" string value to the validator. The validation procedure
is expected to fail (<code>false</code> is returned). Then, the error messages are retrieved with 
the <code>getMessages()</code> method (line 19).</p>
<p><strong>Example 2. Without passing options to the constructor.</strong></p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// Optionally, define a short alias for the validator class name.
use Zend\Validator\EmailAddress;
use Zend\Validator\Hostname;

// Create an instance of the validator.
$validator = new EmailAddress();

// Optionally, configure the validator
$validator-&gt;setAllow(
       Hostname::ALLOW_DNS|Hostname::ALLOW_IP|Hostname::ALLOW_LOCAL);
$validator-&gt;useMxCheck(true);
$validator-&gt;useDeepMxCheck(true);

// Validate an E-mail address.
$isValid = $validator-&gt;isValid('name@example.com'); // Returns true.
$isValid2 = $validator-&gt;isValid('abc'); // Returns false.

if(!$isValid2) {
  // Get error messages in case of validation failure.
  $errors = $validator-&gt;getMessages();
}
</code></pre>
<p>In the code above, we create the <code>EmailAddres</code> validator object with the help of 
the <code>new</code> operator (line 7). </p>
<p>In lines 10-13, we configure the validator. We call the <code>setAllow()</code> method to allow an
E-mail address to be a domain name, an IP address or local network address. Also, we use
the <code>useMxCheck()</code> and <code>useDeepMxCheck()</code> to enable MX record check and deep MX record 
check, respectively.</p>
<p>In line 16, we call the <code>isValid()</code> method and pass it the string value "name@example.com" 
to be checked. The expected output of this call is the boolean <code>true</code>.</p>
<p>In line 17, we pass the "abc" string value to the validator. The validation procedure
is expected to fail. Then, the error messages are retrieved with the <code>getMessages()</code> method (line 21).</p>
<h3 id="Method_2__Using_StaticValidator_Wrapper">9.4.2. Method 2. Using StaticValidator Wrapper</h3>
<p>An alternative way of manual validator instantiation is by using the <code>StaticValidator</code> class. 
The <code>StaticValidator</code> class is some kind of a "proxy" designed for automatic validator
instantiation, configuration and execution. For example, let's consider how to create 
the same <code>EmailAddress</code> validator, configure it and call its <code>isValid()</code> method:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// Create and execute the EmailAddress validator through StaticValidator proxy.
$validatedValue = \Zend\Validator\StaticValidator::execute('name@example.com', 
                    'EmailAddress', 
                    [
                      'allow' =&gt; 
                         Hostname::ALLOW_DNS|
                         Hostname::ALLOW_IP|
                         Hostname::ALLOW_LOCAL,
                      'mxCheck' =&gt; true,
                      'deepMxCheck' =&gt; true
                    ]);
						
// The expected output is boolean true.
</code></pre>
<p>The <code>StaticValidator</code> class provides the <code>execute()</code> static method which takes three 
arguments: the input value, the name of the filter to apply, and the array of 
filter-specific options. </p>
<p>In line 3, we call the <code>execute()</code> method to automatically create the <code>EmailAddress</code> 
validator, call its <code>setAllowDns()</code>, <code>useMxCheck()</code> and <code>useDeepMxCheck()</code> methods, 
and pass the input value to its <code>isValid()</code> method. This is very useful, because 
can be accomplished in a single call.</p>
<blockquote class="notquote information" data-type="information"><p> The <code>StaticValidator</code> doesn't provide an ability to extract the list
 of human-readable validation errors. However, since the <code>StaticValidator</code>
 is designed to be used outside forms, and not intended for displaying results to a human, 
 this seems to be not a big disadvantage.</p>
</blockquote><h3 id="Method_3__Using_an_Array_Configuration">9.4.3. Method 3. Using an Array Configuration</h3>
<p>When using validators with form's validation rules, you typically do not construct a 
validator object explicitly as we did in the previous section, instead you pass an 
array configuration to the factory class which automatically constructs the validator 
for you and (optionally) configures it. We already saw how this works when adding 
validation rules for the feedback form in <a href="../Collecting_User_Input_with_Forms.html">Collecting User Input with Forms</a>.</p>
<p>For example, let's show how to construct the same <code>EmailAddress</code> filter with the help 
of the factory:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// It is assumed that you call the following code inside of the form model's
// addInputFilter() method.

$inputFilter-&gt;add([
  // ...  
  'validators'  =&gt; [
    [
      'name' =&gt; 'EmailAddress',
      'options' =&gt; [
        'allow' =&gt; \Zend\Validator\Hostname::ALLOW_DNS,
        'useMxCheck' =&gt; false,
        'useDeepMxCheck' =&gt; false,
      ],
    ],
  ],                
  // ...
]);
</code></pre>
<p>In the code above, we call the <code>add()</code> method provided by the <code>InputFilter</code> container class (line 5).
The <code>add()</code> method takes an array which has the <code>validators</code> key. You typically register the validators
under that key (line 7). Validators registered under that key are inserted into validator chain in the order
they appear in the list. </p>
<p>A validator configuration typically consists of the <code>name</code> (line 9) and <code>options</code> (line 10). The name
is a fully qualified validator class name (e.g. <code>\Zend\Validator\EmailAddress</code>) or its short alias (<code>EmailAddress</code>).
The <code>options</code> is an array consisting of validator-specific options. When the factory class instantiates
the validator, it passes the list of options to the validator's constructor, and the constructor initializes 
the validator as needed. </p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Checking_Input_Data_with_Validators.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Checking Input Data with Validators</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Checking_Input_Data_with_Validators/Validator_Behaviour_in_Case_of_Invalid_or_Unacceptable_Data.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Checking_Input_Data_with_Validators/About_Validator_Plugin_Manager.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

