<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2016 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Writing Own View Helpers -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Page_Appearance_and_Layout/Adding_CSS_Stylesheets_to_a_Web_Page.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Page_Appearance_and_Layout/View_Models_and_Page_Composition.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Page_Appearance_and_Layout.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Page Appearance and Layout</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">

<h2 id="header-143">6.9. Writing Own View Helpers</h2>
<p>Earlier in this chapter, we've created the layout common to all pages of the web site. 
But we still have a couple of things to do to make the layout fully functional. 
If you remember, the layout template contains the navigation bar
and breadcrumbs. But both navigation bar and breadcrumbs interface components 
provided by Twitter Bootstrap are currently "static", while they need to be 
more interactive. </p>
<p>For example, the active item of the navigation bar should depend on
the controller's action that is being executed at the moment. And the breadcrumbs 
should display the path to the currently viewed page. In this section we will make 
these widgets completely ready for the website with the help of our own view helpers.</p>
<p>A typical view helper is a PHP class deriving from 
<code>Zend\View\Helper\AbstractHelper</code> base class, which in turn implements the
<code>Zend\View\Helper\HelperInterface</code> interface (class inheritance diagram is presented in 
figure 6.9).</p>
<p><span class="image-wrapper">
<a target="_blank" href="../images/appearance/view_helper_inheritance.png">
<img src="../images/appearance/view_helper_inheritance.png" alt="Figure 6.9. View helper class diagram " /></a>
<span class="image-caption">Figure 6.9. View helper class diagram </span>
</span>
</p>
<h3 id="header-144">6.9.1. Menu</h3>
<p>First, let's implement the <code>Menu</code> view helper class that will render the HTML
code of the navigation bar. The <code>Menu</code> class will provide several methods allowing 
to set menu items in a form of array, set the active menu item and render the menu 
(see table 6.4 for method summary).</p>
<div class="table-wrapper">
<div class="table-caption">Table 6.4. Methods of the Menu view helper</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>__construct($items)</code>            </td>
<td>  Class constructor.                                             </td>
</tr>
<tr>
<td> <code>setItems($items)</code>               </td>
<td> Method for setting the menu items.                            </td>
</tr>
<tr>
<td> <code>setActiveItemId($activeItemId)</code> </td>
<td> Method for setting the currently active menu item.            </td>
</tr>
<tr>
<td> <code>render()</code>                       </td>
<td> Renders the menu.                                             </td>
</tr>
<tr>
<td> <code>renderItem($item)</code>              </td>
<td> Renders a single menu item.                                   </td>
</tr>
</tbody>
</table>
</div>
<p>The information describing a single menu item will be represented by 
an array like below (for example, the <em>Home</em> item will have an ID, text 
label and an URL for a hyperlink):</p>
<pre class=""><code class="language-php">[
  'id' =&gt; 'home',
  'label' =&gt; 'Home',
  'link' =&gt; $this-&gt;url('home')
]
</code></pre>
<p>We also want to add the support for dropdown menus as navigation items. For example,
in case of the <em>Support</em> dropdown menu having the <em>Documentation</em> and <em>Help</em> sub-items, 
the item description will take the following form:</p>
<pre class=""><code class="language-php">[
  'id' =&gt; 'support',
  'label' =&gt; 'Support',
  'dropdown' =&gt; [
    [
      'id' =&gt; 'documentation',
      'label' =&gt; 'Documentation',
      'link' =&gt; $this-&gt;url('doc', ['page'=&gt;'contents'])
    ],
    [
      'id' =&gt; 'help',
      'label' =&gt; 'Help',
      'link' =&gt; $this-&gt;url('static', ['page'=&gt;'help'])
    ]
  ]                        
]
</code></pre>
<p>We want to put the <code>Menu</code> class in <code>Application\View\Helper</code> namespace. Thus, start
from creating the <code>Menu.php</code> file in the <em>View/Helper</em> directory under the <em>Application</em>
module's source directory (figure 6.10). </p>
<p><span class="image-wrapper">
<a target="_blank" href="../images/appearance/view_helper_dir.png">
<img src="../images/appearance/view_helper_dir.png" alt="Figure 6.10. View helper directory " /></a>
<span class="image-caption">Figure 6.10. View helper directory </span>
</span>
</p>
<blockquote class="notquote question" data-type="question"><p> <strong>Why do we place the view helper class under module's source directory?</strong></p>
<p> View helpers (unlike <code>.phtml</code> view templates) are stored under module's <code>src/</code> directory,
 because they are usual PHP classes and require to be resolved by a PHP
 class auto-loading feature. On the other hand, view templates are resolved by the special ZF3 class
 called <em>view resolver</em>, and for this reason, view templates are stored under
 the module's <code>view/</code> directory.</p>
</blockquote><p>Next, create the stub code for the <code>Menu</code> class:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\View\Helper;

use Zend\View\Helper\AbstractHelper;

// This view helper class displays a menu bar.
class Menu extends AbstractHelper 
{
  // Menu items array.
  protected $items = [];
    
  // Active item's ID.
  protected $activeItemId = '';
    
  // Constructor.
  public function __construct($items=[]) 
  {
    $this-&gt;items = $items;
  }
    
  // Sets menu items.
  public function setItems($items) 
  {
    $this-&gt;items = $items;
  }
    
  // Sets ID of the active items.
  public function setActiveItemId($activeItemId) 
  {
    $this-&gt;activeItemId = $activeItemId;    
  }  
}
</code></pre>
<p>In the code above, we defined several private fields for the <code>Menu</code>
class. The <code>$items</code> field (line 10) is an array which will store the information 
on the menu items; and the <code>$activeItemId</code> field (line 13) is the ID of an active
menu item. The active menu item will be visually highlighted.</p>
<p>In lines 16-19, we defined the class constructor method, which (optionally)
takes the array of items for initializing the menu. An alternative method of
menu initialization is through the <code>setItems()</code> method (lines 22-25). And the <code>setActiveItemId()</code>
method (lines 28-31) sets the ID of the currently active menu item.</p>
<p>Next, let's add the <code>render()</code> method, which will generate HTML code for 
the whole navigation bar and return it as a text string:</p>
<pre class="line-numbers"><code class="language-php">// Renders the menu.
public function render() 
{
  if (count($this-&gt;items)==0)
    return ''; // Do nothing if there are no items.
        
  $result = '&lt;nav class="navbar navbar-default" role="navigation"&gt;';
  $result .= '&lt;div class="navbar-header"&gt;';
  $result .= '&lt;button type="button" class="navbar-toggle" ';
  $result .= 'data-toggle="collapse" data-target=".navbar-ex1-collapse"&gt;';
  $result .= '&lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;';
  $result .= '&lt;span class="icon-bar"&gt;&lt;/span&gt;';
  $result .= '&lt;span class="icon-bar"&gt;&lt;/span&gt;';
  $result .= '&lt;span class="icon-bar"&gt;&lt;/span&gt;';
  $result .= '&lt;/button&gt;';
  $result .= '&lt;/div&gt;';
       
  $result .= '&lt;div class="collapse navbar-collapse navbar-ex1-collapse"&gt;';
  $result .= '&lt;ul class="nav navbar-nav"&gt;';
        
  // Render items
  foreach ($this-&gt;items as $item) {
    $result .= $this-&gt;renderItem($item);
  }
        
  $result .= '&lt;/ul&gt;';
  $result .= '&lt;/div&gt;';
  $result .= '&lt;/nav&gt;';
        
  return $result;
}
</code></pre>
<p>In the code above, we produce the HTML markup for the Bootstrap navbar component.
The navbar will use the default theme and will be collapsible (adaptive to
different screen widths). The navbar will not have the brand text in the header.
In lines 22-24, we loop through the menu items and render each one with the <code>renderItem()</code>
method. Finally, the <code>render()</code> method returns the resulting HTML code as a text string.</p>
<p>To finish with creating the <code>Menu</code> class, let's implement the <code>renderItem()</code> 
method. This method will produce the HTML code for a single menu item:</p>
<pre class="line-numbers"><code class="language-php">// Renders an item.
protected function renderItem($item) 
{
  $id = isset($item['id']) ? $item['id'] : '';
  $isActive = ($id==$this-&gt;activeItemId);
  $label = isset($item['label']) ? $item['label'] : '';
        
  $result = ''; 
        
  if(isset($item['dropdown'])) {
            
    $dropdownItems = $item['dropdown'];
            
    $result .= '&lt;li class="dropdown ' . ($isActive?'active':'') . '"&gt;';
    $result .= '&lt;a href="#" class="dropdown-toggle" data-toggle="dropdown"&gt;';
    $result .= $label . ' &lt;b class="caret"&gt;&lt;/b&gt;';
           
    $result .= '&lt;ul class="dropdown-menu"&gt;';
 
    foreach ($dropdownItems as $item) {
      $link = isset($item['link']) ? $item['link'] : '#';
      $label = isset($item['label']) ? $item['label'] : '';
                
      $result .= '&lt;li&gt;';
      $result .= '&lt;a href="'.$link.'"&gt;'.$label.'&lt;/a&gt;';
      $result .= '&lt;/li&gt;';
    }
    
    $result .= '&lt;/ul&gt;';
    $result .= '&lt;/a&gt;';
    $result .= '&lt;/li&gt;';
            
  } else {        
    $link = isset($item['link']) ? $item['link'] : '#';
            
    $result .= $isActive?'&lt;li class="active"&gt;':'&lt;li&gt;';
    $result .= '&lt;a href="'.$link.'"&gt;'.$label.'&lt;/a&gt;';
    $result .= '&lt;/li&gt;';
  }
    
  return $result;
}
</code></pre>
<p>In the <code>renderItem()</code> method's code above we did the following.
First, we checked whether the item is a dropdown menu or a simple
item (line 10). If the item is a dropdown menu, we walk through the dropdown
menu items, and render each one in turn (lines 20-27). Lines 34-38 contain the
rendering code for the case of a simple item.</p>
<p>To be able to use the <code>Menu</code> view helper in a view template, it is required
to register it in configuration. To do that, add the following <code>view_helpers</code>
key in the <em>module.config.php</em> file:</p>
<pre class=""><code class="language-php">&lt;?php
return [

    // ...
    
    // The following registers our custom view 
    // helper classes in view plugin manager.
    'view_helpers' =&gt; [
        'factories' =&gt; [
            View\Helper\Menu::class =&gt; InvokableFactory::class,                    
        ],
       'aliases' = [
            'mainMenu' =&gt; View\Helper\Menu::class
       ]
    ],    
];
</code></pre>
<p>In the example above, we registered our <code>Menu</code> class as a <code>mainMenu</code>
view helper and will be able to access it from any view template.</p>
<p>Since we plan to use the <code>Menu</code> view helper in the layout view template, 
replace the navigation menu markup in <em>layout.phtml</em> file with the following code:</p>
<pre class="line-numbers"><code class="language-php">&lt;!-- Navigation bar --&gt;
&lt;?php      
  $this-&gt;mainMenu()-&gt;setItems([
    [
      'id' =&gt; 'home',
      'label' =&gt; 'Home',
      'link' =&gt; $this-&gt;url('home')
    ],
    [
      'id' =&gt; 'downloads',
      'label' =&gt; 'Downloads',
      'link' =&gt; $this-&gt;url("application", ['action'=&gt;'downloads'])
    ],
    [
      'id' =&gt; 'support',
      'label' =&gt; 'Support',
      'dropdown' =&gt; [
        [
          'id' =&gt; 'documentation',
          'label' =&gt; 'Documentation',
          'link' =&gt; $this-&gt;url('doc', ['page'=&gt;'contents'])
        ],
        [
          'id' =&gt; 'help',
          'label' =&gt; 'Help',
          'link' =&gt; $this-&gt;url('static', ['page'=&gt;'help'])
        ]
      ]                        
    ],
    [
      'id' =&gt; 'about',
      'label' =&gt; 'About',
      'link' =&gt; $this-&gt;url('about')
    ],
  ]);

  echo $this-&gt;mainMenu()-&gt;render(); 
?&gt;
</code></pre>
<p>In the code above, we access the registered <code>mainMenu</code> view helper and set 
the navigation bar items with the help of <code>setItems()</code> method (line 3). 
As a parameter for the method, we pass the array of items.
Then we render the navigation bar with the <code>render()</code> method. </p>
<p>To set the active item for the navigation bar, we can call the <code>setActiveItemId()</code> 
method from any view template. For example, add the following code to the beginning of
the view template for the <em>About</em> page (<em>application/index/about.phtml</em>) as follows:</p>
<pre class=""><code class="language-php">&lt;?php
$this-&gt;mainMenu()-&gt;setActiveItemId('about');
?&gt;
</code></pre>
<p>Now, if you open the <em>About</em> page in your browser, you should see that the <em>About</em> item
of the navigation menu is highlighted with a different color. To display the active item 
properly, you need to call the <code>setActiveItemId()</code> method for each page presenting in the
navbar (<em>Home</em>, <em>Downloads</em>, <em>Documentation</em>, etc.) You can see how this is done in the
<em>Hello World</em> sample.</p>
<h3 id="header-145">6.9.2. Breadcrumbs</h3>
<p>Now that you know how to implement a view helper, let's create the second view 
helper for rendering the breadcrumbs. It is completely analogous to the <code>Menu</code>
view helper, so below we just provide the complete code of the <code>Breadcrumbs</code> class:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\View\Helper;

use Zend\View\Helper\AbstractHelper;

// This view helper class displays breadcrumbs.
class Breadcrumbs extends AbstractHelper 
{
  // Array of items.
  private $items = [];
    
  // Constructor.
  public function __construct($items=[]) 
  {                
    $this-&gt;items = $items;
  }
    
  // Sets the items.
  public function setItems($items) 
  {
    $this-&gt;items = $items;
  }
    
  // Renders the breadcrumbs.
  public function render() 
  {
    if(count($this-&gt;items)==0)
      return ''; // Do nothing if there are no items.
        
    // Resulting HTML code will be stored in this var
    $result = '&lt;ol class="breadcrumb"&gt;';
        
    // Get item count
    $itemCount = count($this-&gt;items); 
        
    $itemNum = 1; // item counter
        
    // Walk through items
    foreach ($this-&gt;items as $label=&gt;$link) {
            
      // Make the last item inactive
      $isActive = ($itemNum==$itemCount?true:false);
            
      // Render current item
      $result .= $this-&gt;renderItem($label, $link, $isActive);
                        
      // Increment item counter
      $itemNum++;
    }
        
    $result .= '&lt;/ol&gt;';
        
    return $result;
  }
    
  // Renders an item.
  protected function renderItem($label, $link, $isActive) 
  {
   $result = $isActive?'&lt;li class="active"&gt;':'&lt;li&gt;';
       
    if(!$isActive)
      $result .= '&lt;a href="'.$link.'"&gt;'.$label.'&lt;/a&gt;';
    else
      $result .= $label;
                    
    $result .= '&lt;/li&gt;';
    
    return $result;
  }
}
</code></pre>
<p>To be able to use the <code>Breadcrumbs</code> view helper, register it in the <em>module.config.php</em> file
as follows:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
return [

  //...
    
  // The following registers our custom view helper classes.
  'view_helpers' =&gt; [
    'factories' =&gt; [      
      View\Helper\Breadcrumbs::class =&gt; InvokableFactory::class,          
    ],
    'aliases' =&gt; [
        'pageBreadcrumbs' =&gt; View\Helper\Breadcrumbs::class,
    ]
  ],
];
</code></pre>
<p>Since we plan to use the <code>Breadcrumbs</code> view helper in the layout view template, 
replace the breadcrumbs markup in <em>layout.phtml</em> file with the following code:</p>
<pre class=""><code class="language-php">&lt;!-- Breadcrumbs --&gt;
&lt;?= $this-&gt;pageBreadcrumbs()-&gt;render(); ?&gt;
</code></pre>
<p>In the code above, we access the <code>pageBreadcrumbs()</code> view helper
and call it with the <code>render()</code> method. The <code>echo</code> operator then outputs
the HTML code of the breadcrumbs.</p>
<p>Finally, you need to pass the breadcrumbs items for each view template.
For example, add the following lines in the view template for the <em>About</em> page:</p>
<pre class=""><code class="language-php">&lt;?php
$this-&gt;pageBreadcrumbs()-&gt;setItems([
            'Home'=&gt;$this-&gt;url('home'),
            'About'=&gt;$this-&gt;url('about'),
            ]);
?&gt;
</code></pre>
<p>Now, if you open the about page, you should see breadcrumbs as in figure 6.11 below.
Site users will easily see what page they are visiting right now and will not get lost.</p>
<p><span class="image-wrapper">
<a target="_blank" href="../images/appearance/about_breadcrumbs.png">
<img src="../images/appearance/about_breadcrumbs.png" alt="Figure 6.11. Breadcrumbs for the About page" /></a>
<span class="image-caption">Figure 6.11. Breadcrumbs for the About page</span>
</span>
</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Page_Appearance_and_Layout.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Page Appearance and Layout</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Page_Appearance_and_Layout/Adding_CSS_Stylesheets_to_a_Web_Page.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Page_Appearance_and_Layout/View_Models_and_Page_Composition.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2016 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a> on 2016-09-12 at 06:17            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

