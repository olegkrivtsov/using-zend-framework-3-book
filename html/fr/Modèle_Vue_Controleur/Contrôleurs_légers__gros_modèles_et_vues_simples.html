<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Contrôleurs légers, gros modèles et vues simples &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Modèle_Vue_Controleur/Les_autres_types_de_modèle.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modèle_Vue_Controleur/Résumé.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Modèle_Vue_Controleur.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modèle-Vue-Controleur</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Contrôleurs_légers__gros_modèles_et_vues_simples">4.23. Contrôleurs légers, gros modèles et vues simples</h2>
<p>Lors du développement d'un site à l'aide de la structure Model-View-Controller, il existe un risque de 
mauvaise compréhension du rôle des contrôleurs, des vues et des modèles. Cela a pour conséquence de 
rendre les contrôleurs énormes et les modèles réduits, ce qui rend difficile le test et la prise en 
charge de votre application. 
L'objectif de cette section est de vous donner une idée générale du code qui peut être placé dans une 
classe de contrôleur, du code qui peut être placé dans une vue et du code qui peut être placé dans une 
classe modèle.</p>
<h3 id="Des_Controleurs_Légers">4.23.1. Des Controleurs Légers</h3>
<p>L'idée derrière le terme "contrôleur léger" est que typiquement, dans vos classes de contrôleur, 
vous mettez seulement le code qui :</p>
<ul>
<li>accède aux données de la requete de l'utilisateur (<code>$_GET</code>, <code>$_POST</code>, <code>$_FILES</code> et autres variables PHP);</li>
<li>vérifie la validité des données d'entrée;</li>
<li>(optionnellement) faire quelques préparations de base aux données;</li>
<li>transmettre les données au(x) modèle(s) et récupèrer le résultat renvoyé par le(s) modèle(s);</li>
<li>et finalement renvoyer les données de sortie via le conteneur de variable <code>ViewModel</code>.</li>
</ul>
<p>Une classe contrôleur devrait éviter :</p>
<ul>
<li>de contenir une logique métier complexe, qui est mieux conservée dans les classes de modèles;</li>
<li>de contenir du code HTML ou tout autre code de balisage du rendu dont la place est dans la Vue.</li>
</ul>
<p>Pour un exemple de contrôleur "léger", regardez la classe <code>CurrencyConverterController</code> ci-dessous. 
Ce contrôleur fournit l'action "convert" dont l'objectif est de convertir une somme d'argent de l'euro vers 
l'USD. L'utilisateur transmet le montant d'argent via la variable GET "amount".</p>
<pre class="line-numbers"><code class="language-php">class CurrencyConverterController extends AbstractActionController 
{  
    // Currency converter model
    private $currencyConverter;

    // Constructor. It's purpose is to "inject" dependencies.
    public function __construct($currencyConverter)
    {
        $this-&gt;currencyConverter = $currencyConverter;
    }

    // The "convert" action displays the converted money amount
    public function convertAction() 
    {  
        // Get the money amount from GET
        $amount = (float)$this-&gt;params()-&gt;fromQuery('amount', -1);
    
        // Validate input data
        if($amount&lt;0) {
            // Money amount is missing
            $this-&gt;getResponse()-&gt;setStatusCode(404);
            return;
        }
 
        // Pass the data to the CurrencyConverter model
        $convertedAmount = $this-&gt;currencyConverter-&gt;convertEURtoUSD($amount);	
		
        return new ViewModel([
            'amount'=&gt;$amount,
            'convertedAmount'=&gt;$convertedAmount
        ]);
    }
}
</code></pre>
<p>La méthode action du contrôleur ci-dessus est la suivante:
* Récupère les données transmises par l'utilisateur du site (ligne 16). Ces données font généralement 
 partie de l'objet <code>Request</code> et peuvent être récupérées à l'aide de la méthode <code>getRequest()</code> du contrôleur 
 ou du plugin de controleur <code><a href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/Plugin/Params.html" class="api-link">Params</a></code>.</p>
<ul>
<li><p>Effectue la vérification de base sur les données transmises par l'utilisateur (ligne 19), et si les 
données sont manquantes (ou non valides), définit un code d'erreur HTTP (ligne 21).</p>
</li>
<li><p>Transmet le montant en argent au modèle <code>CurrencyConverter</code> (line 26) en appelant sa méthode 
 <code>convertEURtoUSD()</code>. La méthode renvoie ensuite le montant converti.</p>
</li>
<li><p>Construit le conteneur de variable <code><a href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/View/Model/ViewModel.html" class="api-link">ViewModel</a></code> et lui transmet les données 
résultantes (ligne 28). Ce conteneur de variables est également accessible dans la vue correspondante, 
responsable de la présentation des données.</p>
</li>
</ul>
<h3 id="Gros_Modèles">4.23.2. Gros Modèles</h3>
<p>Parce que vous devez garder vos contrôleurs aussi légers que possible, la majeure partie de la logique 
métier de votre application doit être placée dans des classes modèles. 
Dans une application Model-View-Controller correctement conçue, les modèles semblent "énormes". 
Une classe de modèle peut contenir le code qui :</p>
<ul>
<li><p>Effectue un filtrage et une validation de données complexes. Étant donné que les données que vous avez 
récupérées dans le contrôleur sont transmises à votre application depuis le monde extérieur, dans votre 
modèle, vous devez faire beaucoup d'efforts pour vérifier les données et vous assurer que les données ne 
causeront pas de dommage à votre système. Cela se traduit par un site web sécurisé résistant aux attaques 
des pirates informatiques.</p>
</li>
<li><p>Effectue la manipulation des données. Vos modèles doivent manipuler les données : par ex. charger les 
données depuis la base de données, enregistrer des données dans la base ou encore transformer les données. 
Les modèles sont le bon endroit pour stocker des requêtes de base de données, des fonctions de lecture et 
d'écriture de fichiers, etc.</p>
</li>
</ul>
<p>Dans une classe modèle, il n'est pas recommandé de:</p>
<ul>
<li><p>Accédez aux données des requêtes HTTP, <code>$_GET</code>, <code>$_POST</code> et autres variables PHP. 
C'est le travail du contrôleur d'extraire ces données et les transmettre en entrée au modèle.</p>
</li>
<li><p>Produire du code HTML ou autre code spécifique à la présentation. Le code de présentation peut varier en 
fonction de la demande de l'utilisateur, il est préférable de le placer dans une vue.</p>
</li>
</ul>
<p>Si vous suivez ces principes, vous constaterez que vos modèles seront faciles à tester car ils auront des 
entrées et des sorties clairement identifiées. Vous pourrez écrire un test unitaire qui transmet certaines 
données à la fin de l'entrée du modèle, récupère les données de sortie et vérifie que les données 
sont correctes.</p>
<p>Si vous n'êtes pas sûr d'où mettre certaines parties de code (dans un contrôleur ou dans un modèle), 
demandez-vous : est-ce une logique métier importante qui doit être testée avec soin ? 
Si la réponse est oui, vous devriez mettre le code dans un modèle.</p>
<h3 id="Vue_simples">4.23.3. Vue simples</h3>
<p>Étant donné que la majeure partie de la logique est stockée dans des modèles, vos vues doivent être aussi 
simples que possible pour produire la présentation des données transmises dans le conteneur de variables. 
Dans une vue, vous pouvez :</p>
<ul>
<li><p>Garder du code de balisage HTML statique.</p>
</li>
<li><p>Récupérez des données du conteneur de variables et les afficher.</p>
</li>
<li><p>Si un contrôleur transmet un certain modèle via un conteneur de variables, interrogez le modèle pour 
obtenir des données (par exemple, vous pouvez extraire des lignes de table d'une table de base de 
données et les afficher).</p>
</li>
<li><p>Contenir des opérations simples de contrôle de flux PHP, comme <code>if</code>, <code>foreach</code>, <code>switch</code>, etc. 
Cela permet de varier la présentation en fonction des variables transmises par le contrôleur.</p>
</li>
</ul>
<p>La vue n'est pas recommandé pour :</p>
<ul>
<li><p>Accéder aux données de la requête HTTP et aux variables globales PHP.</p>
</li>
<li><p>Créer des modèles, les manipuler et modifiez l'état de l'application.</p>
</li>
</ul>
<p>Si vous suivez ces principes, vous constaterez que vos vues peuvent facilement être remplacées sans 
modifier la logique métier de votre application. 
Par exemple, vous pouvez facilement modifier la conception de vos pages web, ou même introduire des 
thèmes modifiables.</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Modèle_Vue_Controleur.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modèle-Vue-Controleur</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Modèle_Vue_Controleur/Les_autres_types_de_modèle.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modèle_Vue_Controleur/Résumé.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

