<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Recuperar los datos del formulario desde una acción del controlador &ndash; Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Colectar_las_Entradas_del_Usuario_con_Forms/Instalar_los_componentes_para_formularios_de_ZF3.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Colectar_las_Entradas_del_Usuario_con_Forms/Los_formularios_y_el_Modelo_Vista_Controlador.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Colectar_las_Entradas_del_Usuario_con_Forms.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Colectar las Entradas del Usuario con Forms</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Recuperar_los_datos_del_formulario_desde_una_acción_del_controlador">7.5. Recuperar los datos del formulario desde una acción del controlador</h2>
<p>El sitio web del usuario generalmente trabaja con el formulario en el siguiente
orden:</p>
<ul>
<li><p>Primero, cuando la acción del controlador se ejecuta se imprime la página web
que contiene el formulario que el usuario del sitio debe llenar.
Una vez que los usuarios llenan los campos del formulario y hacen clic
en el botón <em>Submit</em> se genera la petición HTTP y se envían los datos
al servidor.</p>
</li>
<li><p>Segundo, desde el método de acción del controlador podemos extraer los
datos enviados a través de las variables POST (y/o GET) y mostrar la página
con los resultados del procesamiento de los datos.</p>
</li>
</ul>
<p>Generalmente estas dos páginas web se generan en <em>la misma</em> acción del
controlador.</p>
<p>En el siguiente ejemplo mostraremos como podemos crear una acción en
el controlador para mostrar el formulario de contacto y recuperar los datos
enviados por el usuario. Para comenzar agregamos la plantilla de vista
<em>contact-us.phtml</em> dentro de la carpeta <em>application/index</em> que esta dentro
de la carpeta <em>/view</em> del módulo (ver figura 7.6 para un ejemplo).</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/forms/contactus_file.png">
<img src="../../en/images/forms/contactus_file.png" alt="Figura 7.6. Crear el archivo contact-us.phtml" /></a>
<span class="image-caption">Figura 7.6. Crear el archivo contact-us.phtml</span>
</span>
</p>
<p>Colocamos el código HTML del formulario de contacto que usamos en la sección
anterior dentro del archivo de plantilla de vista.</p>
<p>Luego, agregamos el método de acción <code>contactUsAction()</code> a la clase
<code>IndexController</code>. Con el método de acción queremos extraer los datos crudos
del formulario de contacto que fue enviado por el usuario del sitio:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Controller;

// ...

class IndexController extends AbstractActionController
{
  // This action displays the feedback form
  public function contactUsAction()
  {
    // Check if user has submitted the form
    if($this-&gt;getRequest()-&gt;isPost()) {

	  // Retrieve form data from POST variables
	  $data = $this-&gt;params()-&gt;fromPost();

	  // ... Do something with the data ...
	  var_dump($data);
    }

    // Pass form variable to view
    return new ViewModel([
          'form' =&gt; $form
       ]);
  }
}
</code></pre>
<p>En el código de arriba definimos el método de acción <code>contactUsAction()</code>
dentro de la clase <code>IndexController</code> (línea 9).</p>
<p>Luego en las línea 12 revisamos si la solicitud es una petición POST (revisando
la primera línea de la petición HTTP). Generalmente, el formulario usa el
método POST para enviar los datos. Por esta razón podemos detectar si el
formulario se envío o no revisando la primera línea de la petición HTTP.</p>
<p>En la línea 15 recuperamos los datos crudos enviados por el usuario. Extraemos
todas las variables POST con la ayuda del complemento para controladores <code><a target="_blank" href="https://olegkrivtsov.github.io/zf3-api-reference/html/classes/Zend/Mvc/Controller/Plugin/Params.html" class="api-link">Params</a></code>.
Los datos se regresan en forma de un arreglo y se guardan dentro de la variable
<code>$data</code>.</p>
<p>Finalmente debemos agregar una ruta de tipo literal para hacer una URL corta
y fácil de recordar para la página <em>Contactanos</em>. Agregamos la siguiente llave
<code>contactus</code> a la configuración de rutas en el archivo <em>module.config.php</em>:</p>
<pre class=""><code class="language-php">&lt;?php
return [
  // ...
  'router' =&gt; [
    'routes' =&gt; [
      // Add the following routing rule for the "Contact Us" page
      'contactus' =&gt; [
        'type' =&gt; Literal::class,
          'options' =&gt; [
             'route'    =&gt; '/contactus',
             'defaults' =&gt; [
               'controller' =&gt; Controller\IndexController::class,
               'action'     =&gt; 'contactUs',
             ],
           ],
         ],
       ],
    ],
  ],
  // ...
];

</code></pre>
<p>Ahora si escribimos la URL "http://localhost/contactus" en la barra de
navegación del navegador web deberíamos ver una página como la que se muestra
en la figura 7.7.</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/forms/feedback_form.png">
<img src="../../en/images/forms/feedback_form.png" alt="Figura 7.7. Formulario de Contacto" /></a>
<span class="image-caption">Figura 7.7. Formulario de Contacto</span>
</span>
</p>
<p>Ingresamos el correo electrónico, el asunto y el cuerpo de texto y hacemos
clic en el botón <em>Submit</em> del formulario. Los datos serán enviados al
servidor y finalmente extraídos en el método <code>IndexController::contactUsAction()</code>.</p>
<p>Abajo se muestra una ejemplo del arreglo <code>$data</code> (producido con la función
PHP <code>var_dump()</code>). Como podemos ver el arreglo contiene una llave para cada
campo incluyendo el campo "submit".</p>
<pre class=""><code class="language-php">array (size=4)
    'email' =&gt; string 'name@example.com' (length=16)
    'subject' =&gt; string 'Happy New Year!' (length=15)
    'body' =&gt; string 'Dear Support, I'd like to thank you for the
              excellent quality of your support service and wish you
              a Happy New Year!' (length=118)
    'submit' =&gt; string 'Submit' (length=6)
</code></pre>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Colectar_las_Entradas_del_Usuario_con_Forms.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Colectar las Entradas del Usuario con Forms</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Colectar_las_Entradas_del_Usuario_con_Forms/Instalar_los_componentes_para_formularios_de_ZF3.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Colectar_las_Entradas_del_Usuario_con_Forms/Los_formularios_y_el_Modelo_Vista_Controlador.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>
<script src="../../assets/js/popup.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

