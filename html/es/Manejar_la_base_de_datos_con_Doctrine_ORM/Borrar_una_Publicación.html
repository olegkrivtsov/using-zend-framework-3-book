<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Borrar una Publicación -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Manejar_la_base_de_datos_con_Doctrine_ORM/Editar_una_Publicación_Existente.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Manejar_la_base_de_datos_con_Doctrine_ORM/Implementar_la_Vista_Previa_para_la_Publicación.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Manejar_la_base_de_datos_con_Doctrine_ORM.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Manejar la base de datos con Doctrine ORM</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Borrar_una_Publicación">10.11. Borrar una Publicación</h2>
<p>En esta sección implementaremos la acción <code>deleteAction()</code> en el <code>PostController</code>.
Esta acción permite borrar una publicación determinada dado su ID. La acción tomará
el ID desde una variable GET, revisará si una publicación con el Id dado existe, si
existe se borra la publicación, los comentario relacionados y las etiquetas asociadas.
El visitante del sitio será capaz de lanzar la acción ingresando la siguiente URL
en la barra de navegación del navegador web: <em>http://localhost/posts/delete/&lt;id&gt;</em>,
donde <em>&lt;id&gt;</em> es el identificador único de la publicación. Finalmente, la acción
redirecciona al visitante a la página de <em>Admin</em>.</p>
<h3 id="Modificar_el_PostManager">10.11.1. Modificar el PostManager</h3>
<p>Primero agregaremos el método <code>removePost()</code> en el servicio <code>PostManager</code>. Este
método removerá la publicación y los comentarios asociados. Además, borrará las
asociaciones entre la publicación y las etiquetas.</p>
<pre class=""><code class="language-php">&lt;?php
//...
class PostManager
{
  //...

  // Removes post and all associated comments.
  public function removePost($post)
  {
    // Remove associated comments
    $comments = $post-&gt;getComments();
    foreach ($comments as $comment) {
      $this-&gt;entityManager-&gt;remove($comment);
    }

    // Remove tag associations (if any)
    $tags = $post-&gt;getTags();
    foreach ($tags as $tag) {
      $post-&gt;removeTagAssociation($tag);
    }

    $this-&gt;entityManager-&gt;remove($post);

    $this-&gt;entityManager-&gt;flush();
  }
}
</code></pre>
<p>En el código de arriba primero recuperamos todos los comentarios asociados con
una publicación usando del método <code>getComments()</code> de la entidad <code>Post</code>. Luego
se llama al método <code>remove()</code> del <code>EntityManager</code> y se le pasa cada comentario
que queremos borrar.</p>
<p>Luego traemos todas las etiquetas asociadas con la publicación llamando al método
<code>getTags()</code> de <code>Post</code>. Eliminamos la asociación entre la publicación y la etiqueta
(¡pero no la etiqueta misma!) con la ayuda del método <code>removeTagAssociation()</code> de
<code>Post</code> (arriba se puede ver el código del método).</p>
<p>Finalmente borramos la publicación llamando al método <code>remove()</code> del <code>EntityManager</code>.
Y aplicamos los cambios a la base de datos con el método <code>flush()</code>.</p>
<p>Aquí esta el código del método <code>Post::removeTagAssociation()</code>:</p>
<pre class=""><code class="language-php">// Removes association between this post and the given tag.
public function removeTagAssociation($tag)
{
  $this-&gt;tags-&gt;removeElement($tag);
}
</code></pre>
<h3 id="Agregar_el_Controlador_de_Tipo_Acción">10.11.2. Agregar el Controlador de Tipo Acción</h3>
<p>El método <code>PostController::deleteAction()</code> recupera el ID de la publicación que
será borrada y revisa si es un ID de publicación valido. Si es valido se llama al
método <code>PostManager::removePost()</code> para remover la publicación y aplicar los cambios
en la base de datos. Finalmente, redireccionamos al visitante a la página <em>Admin</em>.</p>
<pre class=""><code class="language-php">&lt;?php

//..
class PostController extends AbstractActionController
{
  // This "delete" action displays the Delete Post page.
  public function deleteAction()
  {
    $postId = $this-&gt;params()-&gt;fromRoute('id', -1);

    $post = $this-&gt;entityManager-&gt;getRepository(Post::class)
                -&gt;findOneById($postId);
    if ($post == null) {
      $this-&gt;getResponse()-&gt;setStatusCode(404);
      return;
    }

    $this-&gt;postManager-&gt;removePost($post);

    // Redirect the user to "index" page.
    return $this-&gt;redirect()-&gt;toRoute('posts', ['action'=&gt;'admin']);
  }
}
</code></pre>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Manejar_la_base_de_datos_con_Doctrine_ORM.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Manejar la base de datos con Doctrine ORM</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Manejar_la_base_de_datos_con_Doctrine_ORM/Editar_una_Publicación_Existente.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Manejar_la_base_de_datos_con_Doctrine_ORM/Implementar_la_Vista_Previa_para_la_Publicación.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>


<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

