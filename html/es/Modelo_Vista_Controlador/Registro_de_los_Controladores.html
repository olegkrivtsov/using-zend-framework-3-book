<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Registro de los Controladores -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Modelo_Vista_Controlador/Expresar_Condiciones_de_Error.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modelo_Vista_Controlador/Cuando_Crear_un_Nuevo_Controlador_.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Modelo_Vista_Controlador.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modelo-Vista-Controlador</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Registro_de_los_Controladores">4.9. Registro de los Controladores</h2>
<p>Todas las clases controladoras que pertenecen a un módulo deben ser registradas en el archivo
de configuración <em>module.config.php</em>. Si nuestra clase controladora no necesita usar servicios
(no tiene dependencias) podemos registrarla de la siguiente manera:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
use Zend\ServiceManager\Factory\InvokableFactory;

return [
    // ...

    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\IndexController::class =&gt; InvokableFactory::class
            // Put other controllers registration here
        ],
    ],

    // ...
];
</code></pre>
<p>En la línea 7 tenemos la llave <em>controllers</em> que contiene la subllave <em>factories</em>. Para
registrar una clase controladora agregamos una línea que tenga la forma de un par: <em>llave =&gt; valor</em>.
La llave será el nombre completo (fully qualified name) de la clase controladora, como
<code>\Application\Controller\IndexController</code> (usamos la palabra clave de PHP <code>::class</code> para
la resolución de nombre de clase), y el valor será el nombre de una clase fábrica que creará
la clase controladora que necesitamos usar. En nuestro caso usamos la <code>InvokableFactory</code>
estándar pero podemos crear una propia si es necesario.</p>
<blockquote class="notquote information" data-type="information"><p> Al usar la <code>InvokableFactory</code> decimos a Zend Framework que puede invocar el controlador
 instanciandolo con el operador <code>new</code>. Esta es la manera más simple de instaciar el
 controlador. Como una alternativa, podemos registrar nuestra propia fábrica para crear
 la instancia del controlador e inyectar las dependencias dentro del él.</p>
</blockquote><h3 id="Registrar_una_Fábrica_para_el_Controlador">4.9.1. Registrar una Fábrica para el Controlador</h3>
<p>Si nuestra clase controladora necesita llamar a algún servicio (lo que sucede muy a menudo),
necesitamos pedirlo al <em>administrador de servicios</em> (discutimos sobre el administrador
de servicios en el capítulo <a href="../Operación_del_Sitio_Web.html">Website Operation</a>) y luego pasarlo al
constructor del controlador para que el controlador guarde el servicio que pasamos en una propiedad
privada para su uso interno (a esto se llama inyección de dependencia).</p>
<p>Este procedimiento se implementa típicamente dentro de la clase fábrica. Por ejemplo, asumiendo
que nuestra clase controladora necesita usar el servicio <code>CurrencyConverter</code> que convierte
dinero de USD a EUR. La clase fábrica de nuestro controlador tendrá el siguiente aspecto:</p>
<pre class=""><code class="language-php">&lt;?php
namespace Application\Controller\Factory;

use Zend\ServiceManager\Factory\FactoryInterface;
use Application\Service\CurrencyConverter;
use Application\Controller\IndexController;

// Factory class
class IndexControllerFactory implements FactoryInterface
{
    public function __invoke(ContainerInterface $container,
                     $requestedName, array $options = null)
    {
        // Get the instance of CurrencyConverter service from the service manager.
        $currencyConverter = $container-&gt;get(CurrencyConverter::class);

        // Create an instance of the controller and pass the dependency
        // to controller's constructor.
        return new IndexController($currencyConverter);
    }
}
</code></pre>
<p>Luego registramos el controlador de la misma manera que antes pero especificando
la clase fábrica que hemos escrito antes:</p>
<pre class=""><code class="language-php">&lt;?php
return [
    // ...

    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\IndexController::class =&gt; Controller\Factory\IndexControllerFactory::class
        ],
    ],

    // ...
];
</code></pre>
<blockquote class="notquote information" data-type="information"><p> Si tenemos alguna experiencia con Zend Framework 2 podemos notar que las cosas ahora
 son un poco diferentes que antes. En ZF2 había un método <code>getServiceLocator()</code> en la
 clase base <code>AbstractActionController</code> que permitía traer las dependencias al
 controlador incluso sin la clase fábrica.
 En ZF3 tenemos que pasar las dependencias explícitamente. Esto es un poco más aburrido
 pero elimina las dependencias "ocultas" y hace a nuestro código más claro y fácil de
 entender.</p>
</blockquote><h3 id="LazyControllerAbstractFactory">4.9.2. LazyControllerAbstractFactory</h3>
<p>Escribir una fábrica para cada controlador puede parecer aburrido en un primer
momento. Si somos muy flojos para querer hacerlo podemos usar la clase fábrica
por defecto <code>LazyControllerAbstractFactory</code>.</p>
<blockquote class="notquote tip" data-type="tip"><p> La fábrica <code>LazyControllerAbstractFactory</code> usa <em>reflexión</em> para determinar que servicios
 necesita usar nuestro controlador. Solo necesitamos <em>obligar las dependencias</em> (typehint)
 colocando los servicios como argumentos del constructor del controlador y la fábrica
 recuperará por si misma los servicios necesarios y los pasará al constructor.</p>
</blockquote><p>Por ejemplo, para inyectar el servicio <code>CurrencyConverter</code> en nuestro controlador nos aseguramos
de que el constructor se vea de esta manera:</p>
<pre class=""><code class="language-php">namespace Application\Controller;

use Application\Service\CurrencyConverter;

class IndexController extends AbstractActionController
{
    // Here we will save the service for internal use.
    private $currencyConverter;

    // Typehint the arguments of constructor to get the dependencies.
    public function __construct(CurrencyConverter $currencyConverter)
    {
        $this-&gt;currencyConverter = $currencyConverter;
    }
}
</code></pre>
<p>Luego registramos el controlador de la misma manera pero especificando la fábrica
<code>LazyControllerAbstractFactory</code>:</p>
<pre class=""><code class="language-php">&lt;?php
use Zend\Mvc\Controller\LazyControllerAbstractFactory;

return [
    // ...

    'controllers' =&gt; [
        'factories' =&gt; [
            Controller\IndexController::class =&gt; LazyControllerAbstractFactory::class
        ],
    ],

    // ...
];
</code></pre>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Modelo_Vista_Controlador.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modelo-Vista-Controlador</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Modelo_Vista_Controlador/Expresar_Condiciones_de_Error.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modelo_Vista_Controlador/Cuando_Crear_un_Nuevo_Controlador_.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
$(document).ready(function() {

$(document).on('click', '#contact-close', function(event){
    event.preventDefault();
    setCookie('contact-cookie', '1', 30);
    $('#contact_popup').slideToggle();
});

if ($(document).width() < 640) {
    return; // Don't show this popup on small devices
}
 
var style = `
<style>
#contact_popup {
 width:360px;
 padding:20px;
 background:#4185f2;
 position:fixed;
 left:50%;
 margin-left: -180px;
 bottom:0;
 padding: 10px;
 display:none;
 -moz-border-radius-topleft:20px;
 -moz-border-radius-topright:20px;
 -webkit-border-top-left-radius:20px;
 -webkit-border-top-right-radius:20px;
}
#contact_popup h1 {
 margin-top: 0;
 color:#fff;
 font-size:20px;
}
#contact_popup p {
 margin:0;
 color:#fff;
}

.contact-btn {
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
}

.btn-yes {
    background-color: #4CAF50; /* Green */
}

.btn-no {
    background-color: red;
}
</style> 
`;

$('head').append(style);
 
 var popupDiv = `
<div id="contact_popup">
   <h1>Need Help with ZF3?</h1>
   
   <p>You can contact Oleg (author of this book) to get paid consulting and/or ZF3 development assistance.</p>
   <br>
   <p>
     <a class="contact-btn btn-yes" href="https://olegkrivtcov.wordpress.com/contact/">Contact now</a>&nbsp;&nbsp;<a id="contact-close" class="contact-btn btn-no" href="#">Not Now</a>
   </P>
 </div>
</div>`;
 
 $('body').append(popupDiv);

var cookie = getCookie('contact-cookie');

if (cookie)
    return; // Don't show this popup if user refused

if (Math.floor(Math.random() * 50) > 1) {
    return; // Show this popup in 2% of views
}

$('#contact_popup').slideToggle();
 
 function openPopup(hash) {
   $(hash + '_popup').slideToggle().addClass('open');
 }
 
 function openAndClose(hash) {
   if ($(hash + '_popup').hasClass('open')) {
     $($(hash + '_popup')).slideToggle().removeClass();
   } else {
     $('#container div.open').slideToggle().removeClass();
     $(hash + '_popup').slideToggle().addClass('open');
   }
 }
 
 function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}

function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function eraseCookie(name) {   
    document.cookie = name+'=; Max-Age=-99999999;';  
}
 
});
</script><script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

