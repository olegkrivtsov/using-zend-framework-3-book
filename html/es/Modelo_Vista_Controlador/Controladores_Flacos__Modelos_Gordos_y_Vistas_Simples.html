<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Controladores Flacos, Modelos Gordos y Vistas Simples -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Modelo_Vista_Controlador/Otros_Tipos_de_Modelos.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modelo_Vista_Controlador/Resumen.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Modelo_Vista_Controlador.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modelo-Vista-Controlador</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Controladores_Flacos__Modelos_Gordos_y_Vistas_Simples">4.23. Controladores Flacos, Modelos Gordos y Vistas Simples</h2>
<p>Cuando desarrollamos un sitio web usando el patrón Modelo-Vista-Controlador está
el riesgo de mal interpretar el rol de los controladores, las vistas y los
modelos. El resultado de esto es controladores enormes y modelos pequeños lo que
hace difícil probar y mantener nuestra aplicación. El objetivo de esta sección
es dar una comprensión general sobre el código que se puede colocar en la clase
controladora, el que se puede colocar en la plantilla de vista y el código
que se puede colocar en una clase modelo.</p>
<h3 id="Controladores_Flacos">4.23.1. Controladores Flacos</h3>
<p>La idea que está detrás del termino "controladores flacos" (skinny controller)
es que generalmente en nuestras clases controladoras solo colocamos código que:</p>
<ul>
<li>Acceder a los datos de la petición del usuario (<code>$_GET</code>, <code>$_POST</code>, <code>$_FILES</code>
y otras variables PHP).</li>
<li>Revisar la validez de los datos de entrada.</li>
<li>Hacer algunas preparaciones básicas a los datos (opcional).</li>
<li>Pasar los datos a el o los modelos y recuperar el resultado regresados por
el o los modelos.</li>
<li>Y finalmente, regresar los datos como parte del contenedor de variables
<code>ViewModel</code>.</li>
</ul>
<p>A controller class should avoid:</p>
<ul>
<li>Contener reglas complejas de la lógica de negocios que es mejor mantenerlas en
las clases de modelo.</li>
<li>Contener HTML o cualquier otro tipo de código de marcado propio de la capa
de presentación. Este es mejor que se coloque en las platillas de vista.</li>
</ul>
<p>Para un ejemplo de un controlador "flaco" miremos más abajo la clase
<code>CurrencyConverterController</code>. Este controlador provee el método de acción
"convert" cuyo objetivo es convertir un cantidad de EUR a USD. El usuario pasa
la cantidad de dinero a través de la variable GET "amount".</p>
<pre class="line-numbers"><code class="language-php">class CurrencyConverterController extends AbstractActionController
{
    // Currency converter model
    private $currencyConverter;

    // Constructor. It's purpose is to "inject" dependencies.
    public function __construct($currencyConverter)
    {
        $this-&gt;currencyConverter = $currencyConverter;
    }

    // The "convert" action displays the converted money amount
    public function convertAction()
    {
        // Get the money amount from GET
        $amount = (float)$this-&gt;params()-&gt;fromQuery('amount', -1);

        // Validate input data
        if($amount&lt;0) {
            // Money amount is missing
            $this-&gt;getResponse()-&gt;setStatusCode(404);
            return;
        }

        // Pass the data to the CurrencyConverter model
        $convertedAmount = $this-&gt;currencyConverter-&gt;convertEURtoUSD($amount);

        return new ViewModel([
            'amount'=&gt;$amount,
            'convertedAmount'=&gt;$convertedAmount
        ]);
    }
}
</code></pre>
<p>El método de acción del controlador anterior hace lo siguiente:</p>
<ul>
<li><p>Toma los datos pasados por el usuario (línea 16). Estos datos son usualmente
parte del objeto <code>Request</code> que se pueden recuperar usando el método del controlador
<code>getRequest()</code> o por medio del complemento para controladores <code>Params</code>.</p>
</li>
<li><p>Ejecutar revisiones básicas sobre los datos que el usuario pasa (línea 19) y
si los datos no existen o son inválidos colocamos un código de error HTTP
(línea 21).</p>
</li>
<li><p>Pasar la cantidad de dinero al modelo <code>CurrencyConverter</code> (línea 26) mediante
el llamado al método <code>convertEURtoUSD()</code>. Luego el método regresa la cantidad
convertida.</p>
</li>
<li><p>Construye el contenedor de variables <code>ViewModel</code> y le pasa los datos resultantes
(línea 28). A este contenedor de variables se puede acceder luego en la
correspondiente plantilla de vista responsable de la presentación de los datos.</p>
</li>
</ul>
<h3 id="Modelos_Gordos">4.23.2. Modelos Gordos</h3>
<p>Como necesitamos mantener nuestros controladores tan flacos como sea posible
la mayoría de la lógica de negocio de nuestra aplicación se debería colocar
dentro de las clases modelo. En una aplicación diseñada correctamente bajo el
patrón Modelo-Vista-Controlador los modelos se ven "enormes". Una clase de
modelo puede contener código que:</p>
<ul>
<li><p>Ejecuta filtrado de datos y validaciones complejas. Como los datos que
recuperamos en el controlador están entrando a nuestra aplicación desde el
mundo exterior en el modelo tenemos que esforzarnos por verificarlos
y asegurar que estos no rompan nuestros sistema. El resultado de esto es un
sitio web seguro que resiste los ataque de los crackers.</p>
</li>
<li><p>Manipula los datos. Nuestros modelos deben manipular los datos, por ejemplo,
cargar los datos desde la base de datos, guardarlos en la base de datos y
transformar los datos. Los modelos son el lugar correcto para guardar
las consultas de base de datos, los funcionalidades de lectura y escritura de
archivos, etc.</p>
</li>
</ul>
<p>En las clases de modelo no es recomendable:</p>
<ul>
<li><p>Acceder a los datos de las petición HTTP, <code>$_GET</code>, <code>$_POST</code> y otras variables
PHP. Ese es el trabajo del controlador: extraer los datos y pasarlos a la
entrada del modelo.</p>
</li>
<li><p>Producir código HTML u otro código específico de la presentación. El código
de presentación puede variar dependiendo de la petición del usuario y es
mejor colocarlo en la plantilla de vista.</p>
</li>
</ul>
<p>Si seguimos estos principios encontraremos que nuestros modelos son fáciles
de probar porque ellos tienen identificados claramente las entradas y las salidas.
Podemos escribir pruebas unitarias que pasan determinados datos de prueba como
entrada a los modelos, recuperar los datos de salida y verificar que los
datos son correctos.</p>
<p>Si estamos confundidos sobre donde colocar un determinado segmento de código
o en el controlador o en el modelo, podemos intentar preguntarnos a nosotros mismos:
¿Es este pedazo de código una regla del negocio importante que necesita ser
cuidadosamente probada? si la respuesta es sí debemos colocar el código en un
modelo.</p>
<h3 id="Plantillas_de_Vista_Simple">4.23.3. Plantillas de Vista Simple</h3>
<p>Como la mayoría de la lógica se guarda en los modelos, nuestras plantillas de
vista serán tan simples como sea posible para producir la presentación de los
datos que se pasan a través del contenedor de variables. En una plantilla de
vista podemos:</p>
<ul>
<li><p>Tener código HTML estático.</p>
</li>
<li><p>Recuperar los datos desde el contenedor de variables e imprimirlos en el
flujo de salida PHP.</p>
</li>
<li><p>Si un controlador pasa un determinado modelo por medio del contenedor de
variables podemos consultar los datos del modelo
(por ejemplo, podemos recuperar las columnas de una tabla de base de datos
e imprimirlas).</p>
</li>
<li><p>Contener estructuras de control simples de PHP como: <code>if</code>, <code>foreach</code>, <code>switch</code>,
etc. Esto permite variar la presentación dependiendo de las variables pasadas
por el controlador.</p>
</li>
</ul>
<p>No es recomendable que las plantillas de vista:</p>
<ul>
<li><p>Acceder a los datos de la petición HTTP y a las variables PHP super globales.</p>
</li>
<li><p>Crear modelos, manipularlos y modificar el estado de la aplicación.</p>
</li>
</ul>
<p>Si seguimos estos principios encontraremos que nuestras vistas se pueden sustituir
facílmente sin modificar la lógica de negocio de nuestra aplicación. Por ejemplo,
podemos fácilmente cambiar el diseño de nuestra página web o introducir
temas intercambiables.</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Modelo_Vista_Controlador.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Modelo-Vista-Controlador</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Modelo_Vista_Controlador/Otros_Tipos_de_Modelos.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Modelo_Vista_Controlador/Resumen.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>


<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

